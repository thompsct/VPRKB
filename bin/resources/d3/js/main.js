// Test graph data
var testGraphData = {"nodes":[{"group":0,"name":"VrestPulArtCaps"},{"group":0,"name":"EminRV"},{"group":0,"name":"EminRA"},{"group":2,"name":"CardiacOutput"},{"group":0,"name":"CardiacOutput:t"},{"group":0,"name":"CSysArtCaps"},{"group":2,"name":"VSysArtCaps:t"},{"group":2,"name":"FAorticValve"},{"group":2,"name":"FSysArtCaps"},{"group":2,"name":"VRA:t"},{"group":2,"name":"FSysVeins"},{"group":2,"name":"FTricuspidValve"},{"group":0,"name":"RSysVeins"},{"group":2,"name":"VLA:t"},{"group":2,"name":"FMitralValve"},{"group":2,"name":"FPulVeins"},{"group":0,"name":"VrestLVs"},{"group":0,"name":"VrestLAd"},{"group":0,"name":"ERA"},{"group":0,"name":"EmaxRA"},{"group":0,"name":"ActFuncAtria"},{"group":1,"name":"PRV"},{"group":0,"name":"VrestRV"},{"group":1,"name":"VRV"},{"group":0,"name":"ERV"},{"group":0,"name":"VrestRAd"},{"group":0,"name":"RAorticValve"},{"group":1,"name":"VLA"},{"group":0,"name":"CPulArtCaps"},{"group":1,"name":"PLV"},{"group":0,"name":"VrestLV"},{"group":0,"name":"ELV"},{"group":1,"name":"VLV"},{"group":0,"name":"VrestLAs"},{"group":0,"name":"VrestLVd"},{"group":1,"name":"VPulArtCaps"},{"group":2,"name":"VPulArtCaps:t"},{"group":0,"name":"ELA"},{"group":0,"name":"EminLA"},{"group":0,"name":"EmaxLA"},{"group":0,"name":"VrestRVs"},{"group":0,"name":"VrestRVd"},{"group":0,"name":"ActFuncVentricles"},{"group":0,"name":"VrestSysArtCaps"},{"group":0,"name":"VrestSysVeins"},{"group":2,"name":"VRV:t"},{"group":2,"name":"FPulValve"},{"group":0,"name":"RPulVeins"},{"group":0,"name":"EmaxRV"},{"group":0,"name":"RPulArtCaps"},{"group":1,"name":"VRA"},{"group":0,"name":"Rartcap"},{"group":2,"name":"HR"},{"group":1,"name":"PPulArtCaps"},{"group":1,"name":"PRA"},{"group":0,"name":"VrestRA"},{"group":0,"name":"t.delta"},{"group":0,"name":"CSysVeins"},{"group":1,"name":"Paorta"},{"group":0,"name":"EminLV"},{"group":0,"name":"VrestLA"},{"group":1,"name":"VSysArtCaps"},{"group":0,"name":"EmaxLV"},{"group":0,"name":"VrestRAs"},{"group":2,"name":"FPulArtCaps"},{"group":1,"name":"PPulVeins"},{"group":0,"name":"RTricuspidValve"},{"group":2,"name":"VLV:t"},{"group":0,"name":"CPulVeins"},{"group":2,"name":"VPulVeins:t"},{"group":0,"name":"RPulValve"},{"group":1,"name":"Vtotal"},{"group":1,"name":"VPulVeins"},{"group":1,"name":"VSysVeins"},{"group":2,"name":"VSysVeins:t"},{"group":0,"name":"VrestPulVeins"},{"group":0,"name":"PRint"},{"group":0,"name":"t"},{"group":0,"name":"EDVRV"},{"group":0,"name":"EDVLV"},{"group":0,"name":"RMitralValve"},{"group":1,"name":"PLA"},{"group":1,"name":"PSysVeins"}],"links":[{"source":4,"target":3,"value":1},{"source":7,"target":6,"value":1},{"source":8,"target":6,"value":1},{"source":10,"target":9,"value":1},{"source":11,"target":9,"value":1},{"source":14,"target":13,"value":1},{"source":15,"target":13,"value":1},{"source":2,"target":18,"value":1},{"source":19,"target":18,"value":1},{"source":20,"target":18,"value":1},{"source":22,"target":21,"value":1},{"source":23,"target":21,"value":1},{"source":24,"target":21,"value":1},{"source":13,"target":27,"value":1},{"source":30,"target":29,"value":1},{"source":31,"target":29,"value":1},{"source":32,"target":29,"value":1},{"source":36,"target":35,"value":1},{"source":38,"target":37,"value":1},{"source":39,"target":37,"value":1},{"source":20,"target":37,"value":1},{"source":40,"target":22,"value":1},{"source":41,"target":22,"value":1},{"source":42,"target":22,"value":1},{"source":11,"target":45,"value":1},{"source":46,"target":45,"value":1},{"source":1,"target":24,"value":1},{"source":48,"target":24,"value":1},{"source":42,"target":24,"value":1},{"source":7,"target":4,"value":1},{"source":3,"target":4,"value":1},{"source":9,"target":50,"value":1},{"source":0,"target":53,"value":1},{"source":28,"target":53,"value":1},{"source":35,"target":53,"value":1},{"source":18,"target":54,"value":1},{"source":50,"target":54,"value":1},{"source":55,"target":54,"value":1},{"source":26,"target":7,"value":1},{"source":58,"target":7,"value":1},{"source":29,"target":7,"value":1},{"source":33,"target":60,"value":1},{"source":17,"target":60,"value":1},{"source":20,"target":60,"value":1},{"source":6,"target":61,"value":1},{"source":62,"target":31,"value":1},{"source":59,"target":31,"value":1},{"source":42,"target":31,"value":1},{"source":49,"target":64,"value":1},{"source":65,"target":64,"value":1},{"source":53,"target":64,"value":1},{"source":21,"target":11,"value":1},{"source":66,"target":11,"value":1},{"source":54,"target":11,"value":1},{"source":25,"target":55,"value":1},{"source":63,"target":55,"value":1},{"source":20,"target":55,"value":1},{"source":67,"target":32,"value":1},{"source":64,"target":69,"value":1},{"source":15,"target":69,"value":1},{"source":7,"target":67,"value":1},{"source":14,"target":67,"value":1},{"source":21,"target":46,"value":1},{"source":70,"target":46,"value":1},{"source":53,"target":46,"value":1},{"source":27,"target":71,"value":1},{"source":72,"target":71,"value":1},{"source":61,"target":71,"value":1},{"source":23,"target":71,"value":1},{"source":50,"target":71,"value":1},{"source":73,"target":71,"value":1},{"source":35,"target":71,"value":1},{"source":32,"target":71,"value":1},{"source":10,"target":74,"value":1},{"source":8,"target":74,"value":1},{"source":16,"target":30,"value":1},{"source":42,"target":30,"value":1},{"source":34,"target":30,"value":1},{"source":45,"target":23,"value":1},{"source":76,"target":42,"value":1},{"source":77,"target":42,"value":1},{"source":52,"target":42,"value":1},{"source":68,"target":65,"value":1},{"source":75,"target":65,"value":1},{"source":72,"target":65,"value":1},{"source":56,"target":78,"value":1},{"source":78,"target":78,"value":1},{"source":76,"target":78,"value":1},{"source":77,"target":78,"value":1},{"source":52,"target":78,"value":1},{"source":56,"target":79,"value":1},{"source":79,"target":79,"value":1},{"source":76,"target":79,"value":1},{"source":77,"target":79,"value":1},{"source":52,"target":79,"value":1},{"source":80,"target":14,"value":1},{"source":29,"target":14,"value":1},{"source":81,"target":14,"value":1},{"source":64,"target":36,"value":1},{"source":46,"target":36,"value":1},{"source":74,"target":73,"value":1},{"source":77,"target":20,"value":1},{"source":52,"target":20,"value":1},{"source":27,"target":81,"value":1},{"source":60,"target":81,"value":1},{"source":37,"target":81,"value":1},{"source":43,"target":58,"value":1},{"source":61,"target":58,"value":1},{"source":5,"target":58,"value":1},{"source":57,"target":82,"value":1},{"source":44,"target":82,"value":1},{"source":73,"target":82,"value":1},{"source":69,"target":72,"value":1},{"source":82,"target":10,"value":1},{"source":12,"target":10,"value":1},{"source":54,"target":10,"value":1},{"source":47,"target":15,"value":1},{"source":65,"target":15,"value":1},{"source":81,"target":15,"value":1},{"source":58,"target":8,"value":1},{"source":82,"target":8,"value":1},{"source":51,"target":8,"value":1}],"groups":{"0":"Constitutive","1":"State","2":"Rate"}}

$(window).load(function load() {
	if(typeof javaCommandReciever === 'undefined')
		loadGraph(testGraphData);
	else {
		javaCommandReciever.onLoadGraph(function (data) {
			loadGraph(data);
		});
	}

	javaCommandReciever.onLoadGraph(function (data) {
		// Listen for clicks on the graph type buttons
		$(".graphTypes>li").click(showGraph);

		var color = d3.scale.category10();
		
		// Build the legend
		var legend = $(".legend")[0];
		var groupsWithColors = {};
		for(group in graph.groups)
		{
			var className = "legendItem" + group;
			legend.innerHTML +=
				"<li class='" + className + "'>" +
					graph.groups[group]	+																// Group name
					"<style> ." + className + ":before { color: " + color(group) + "; } </style>" +		// Group color
				"</li>";
		}
		
		// Simulate a click on the default graph button so the default graph shows
		$(".defaultGraphButton").click();
	});
});

function loadGraph(data) {
	// Listen for clicks on the graph type buttons
	$(".graphTypes>li").click(showGraph);

	var color = d3.scale.category10();
	
	// Build the legend
	var legend = $(".legend")[0];
	var groupsWithColors = {};
	for(group in graph.groups)
	{
		var className = "legendItem" + group;
		legend.innerHTML +=
			"<li class='" + className + "'>" +
				graph.groups[group]	+																// Group name
				"<style> ." + className + ":before { color: " + color(group) + "; } </style>" +		// Group color
			"</li>";
	}
	
	// Simulate a click on the default graph button so the default graph shows
	$(".defaultGraphButton").click();
}

function showGraph() {
	// Deselect the currently selected button
	$(".selected").removeClass("selected");
	
	// Ensure all frames are hidden
	$(".graphFrame").hide();
	
	var selectedButton = $(this);
	
	// Select the button that was clicked
	selectedButton.addClass("selected");
	
	// Show the frame associated with this button
	$("." + selectedButton.attr("data-graph-className")).fadeIn();
}